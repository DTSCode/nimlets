dependencies:
  pre:
    - sudo apt-get install python3-dev gcc
    - |
        if [ ! -x ~/nim/bin/nim ];
        then
          git clone -b devel --depth 1 https://github.com/Araq/Nimrod.git ~/nim/
          git clone -b devel --depth 1 git://github.com/nimrod-code/csources ~/nim/csources/
          cd ~/nim/csources
          sh build.sh
          cd ../
          bin/nim c koch
          ./koch boot
          if [ ! -a ~/bin/nim]; then
            ln -s ~/nim/bin/nim ~/bin/nim
          fi
        fi

  cache_directories:
    - "~/bin/"
    - "~/nim/"

## Customize test commands
test:
  override:
    - ./build $CIRCLE_ARTIFACTS

## Customize deployment commands
deployment:
  staging:
    branch: master
    commands:
      - git config --global user.email "you@example.com"
      - git config --global user.name "Your Name"
      - git init $CIRCLE_ARTIFACTS
      - git -C $CIRCLE_ARTIFACTS add .
      - git -C $CIRCLE_ARTIFACTS commit -m 'Build Site'
      - git -C $CIRCLE_ARTIFACTS remote add origin git@github.com:nimlets/nimlets.github.io.git
      - git -C $CIRCLE_ARTIFACTS push origin master
